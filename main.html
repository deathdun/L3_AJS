<!DOCTYPE html>
<html>
<head>
    <title>L3_AJS - Async/Await Demo</title>
</head>
<body>
    <h1>Результаты запросов через async/await</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        async function makeAsyncRequest(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
        }

        async function getAndSortPostsAsync() {
            const posts = await makeAsyncRequest('https://jsonplaceholder.typicode.com/posts');
            return posts.sort((a, b) => b.title.length - a.title.length);
        }

        async function getAndSortCommentsAsync() {
            const comments = await makeAsyncRequest('https://jsonplaceholder.typicode.com/comments');
            return comments.sort((a, b) => a.name.localeCompare(b.name));
        }

        async function getAndFilterUsersAsync() {
            const users = await makeAsyncRequest('https://jsonplaceholder.typicode.com/users');
            return users.map(user => ({
                id: user.id,
                name: user.name,
                username: user.username,
                email: user.email,
                phone: user.phone
            }));
        }

        async function getAndFilterTodosAsync() {
            const todos = await makeAsyncRequest('https://jsonplaceholder.typicode.com/todos');
            return todos.filter(todo => !todo.completed);
        }

        async function demonstrateAsyncAwait() {
            try {
                output.innerHTML += '<h2>Posts (отсортированы по длине title):</h2>';
                const posts = await getAndSortPostsAsync();
                posts.slice(0, 3).forEach(post => {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                            <h3>${post.title}</h3>
                            <p><strong>ID:</strong> ${post.id}</p>
                            <p><strong>Длина title:</strong> ${post.title.length} символов</p>
                            <p>${post.body.substring(0, 100)}...</p>
                        </div>
                    `;
                });

                output.innerHTML += '<h2>Comments (отсортированы по имени):</h2>';
                const comments = await getAndSortCommentsAsync();
                comments.slice(0, 3).forEach(comment => {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                            <h3>${comment.name}</h3>
                            <p><strong>Email:</strong> ${comment.email}</p>
                            <p>${comment.body.substring(0, 100)}...</p>
                        </div>
                    `;
                });

                output.innerHTML += '<h2>Users (только выбранные поля):</h2>';
                const users = await getAndFilterUsersAsync();
                users.slice(0, 3).forEach(user => {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                            <h3>${user.name}</h3>
                            <p><strong>Username:</strong> ${user.username}</p>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Phone:</strong> ${user.phone}</p>
                        </div>
                    `;
                });

                output.innerHTML += '<h2>Todos (только невыполненные):</h2>';
                const todos = await getAndFilterTodosAsync();
                todos.slice(0, 5).forEach(todo => {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 5px; padding: 5px; background: #fff3cd">
                            <p><strong>ID:</strong> ${todo.id}</p>
                            <p><strong>Title:</strong> ${todo.title}</p>
                            <p><strong>Completed:</strong> Нет</p>
                        </div>
                    `;
                });
                output.innerHTML += `<p><strong>Всего невыполненных задач:</strong> ${todos.length}</p>`;

            } catch (error) {
                output.innerHTML += `<p style="color: red;">Ошибка: ${error.message}</p>`;
            }
        }

        demonstrateAsyncAwait();
    </script>
</body>
</html>