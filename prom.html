<!DOCTYPE html>
<html>
<head>
    <title>L3_AJS - Promises Demo</title>
</head>
<body>
    <h1>Результаты запросов через промисы</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        function makePromiseRequest(url) {
            return fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                });
        }

        function getAndFilterUsers() {
            return makePromiseRequest('https://jsonplaceholder.typicode.com/users')
                .then(users => {
                    return users.map(user => ({
                        id: user.id,
                        name: user.name,
                        username: user.username,
                        email: user.email,
                        phone: user.phone
                    }));
                });
        }

        function getAndFilterTodos() {
            return makePromiseRequest('https://jsonplaceholder.typicode.com/todos')
                .then(todos => {
                    return todos.filter(todo => !todo.completed);
                });
        }

        output.innerHTML += '<h2>Users (только выбранные поля):</h2>';
        
        getAndFilterUsers()
            .then(users => {
                users.slice(0, 5).forEach(user => {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                            <h3>${user.name}</h3>
                            <p><strong>ID:</strong> ${user.id}</p>
                            <p><strong>Username:</strong> ${user.username}</p>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Phone:</strong> ${user.phone}</p>
                        </div>
                    `;
                });
                
                output.innerHTML += '<h2>Todos (только невыполненные):</h2>';
                
                return getAndFilterTodos();
            })
            .then(todos => {
                todos.slice(0, 10).forEach(todo => {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 5px; padding: 5px; background: ${todo.completed ? '#d4edda' : '#fff3cd'}">
                            <p><strong>ID:</strong> ${todo.id}</p>
                            <p><strong>Title:</strong> ${todo.title}</p>
                            <p><strong>Completed:</strong> ${todo.completed ? 'Да' : 'Нет'}</p>
                            <p><strong>User ID:</strong> ${todo.userId}</p>
                        </div>
                    `;
                });
                
                output.innerHTML += `<p><strong>Всего невыполненных задач:</strong> ${todos.length}</p>`;
            })
            .catch(error => {
                output.innerHTML += `<p style="color: red;">Ошибка: ${error.message}</p>`;
            });
    </script>
</body>
</html>